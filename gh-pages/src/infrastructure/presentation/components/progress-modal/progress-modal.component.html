<div class="progress-modal">
  <div class="modal-header">
    <h2 mat-dialog-title class="modal-title">
      <mat-icon class="title-icon">architecture</mat-icon>
      {{ data.title }}
    </h2>
  </div>

  <mat-dialog-content class="modal-content">
    <div class="progress-section">
      <!-- Overall Progress Bar -->
      <div class="overall-progress">
        <div class="progress-info">
          <span class="progress-label">Overall Progress</span>
          <span class="progress-percentage"
            >{{ Math.round(progressState.overallProgress) }}%</span
          >
        </div>
        <mat-progress-bar
          mode="determinate"
          [value]="progressState.overallProgress"
          class="main-progress-bar">
        </mat-progress-bar>
      </div>

      <!-- Current Step Information -->
      @if (progressState.currentStep) {
        <div class="current-step">
          <div class="step-header">
            <mat-icon
              class="step-icon"
              [class.spinning]="progressState.isRunning">
              {{ getStepIcon(progressState.currentStep) }}
            </mat-icon>
            <span class="step-label">{{
              progressState.currentStep.label
            }}</span>
          </div>

          <!-- Estimated Time Remaining -->
          @if (progressState.estimatedTimeRemaining) {
            <div class="time-estimate">
              <mat-icon class="time-icon">schedule</mat-icon>
              <span
                >{{
                  formatTime(progressState.estimatedTimeRemaining)
                }}
                remaining</span
              >
            </div>
          }
        </div>
      }

      <!-- Steps List -->
      <div class="steps-list">
        @for (step of progressState.steps; track step.label; let i = $index) {
          <div
            class="step-item"
            [class.completed]="step.completed"
            [class.current]="i === progressState.currentStepIndex"
            [class.error]="step.error">
            <div class="step-indicator">
              @if (step.completed && !step.error) {
                <mat-icon class="step-icon completed">check_circle</mat-icon>
              } @else if (step.error) {
                <mat-icon class="step-icon error">error</mat-icon>
              } @else if (
                !step.completed &&
                !step.error &&
                i === progressState.currentStepIndex
              ) {
                <mat-icon class="step-icon current spinning"
                  >radio_button_unchecked</mat-icon
                >
              } @else {
                <mat-icon class="step-icon pending"
                  >radio_button_unchecked</mat-icon
                >
              }
            </div>

            <div class="step-details">
              <span class="step-name">{{ step.label }}</span>
              @if (step.error) {
                <span class="step-error">{{ step.error }}</span>
              }
              @if (step.completed && step.startTime && step.endTime) {
                <span class="step-duration">
                  {{ formatDuration(step.endTime - step.startTime) }}
                </span>
              }
            </div>
          </div>
        }
      </div>

      <!-- Error Message -->
      @if (progressState.error) {
        <div class="error-section">
          <mat-icon class="error-icon">error_outline</mat-icon>
          <span class="error-message">{{ progressState.error }}</span>
        </div>
      }

      <!-- Completion Message -->
      @if (
        !progressState.isRunning &&
        !progressState.error &&
        progressState.overallProgress >= 100
      ) {
        <div class="completion-section">
          <mat-icon class="completion-icon">check_circle</mat-icon>
          <div class="completion-content">
            <span class="completion-message">
              Project generation completed successfully!
            </span>
            <span class="completion-hint">
              Click outside this dialog to close
            </span>
          </div>
        </div>
      }
    </div>
  </mat-dialog-content>

  @if (data.allowCancel && progressState.isRunning) {
    <mat-dialog-actions class="modal-actions">
      <button mat-button (click)="cancel()" class="cancel-button">
        <mat-icon>close</mat-icon>
        Cancel
      </button>
    </mat-dialog-actions>
  }
</div>
