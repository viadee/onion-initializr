<div class="modal-overlay" *ngIf="isOpen" (click)="onOverlayClick($event)">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Upload JSON File</h3>
      <button class="close-btn" (click)="closeModal()">x</button>
    </div>

    <div class="modal-body">
      <div
        class="upload-area"
        [class.dragover]="isDragOver"
        [class.uploading]="isUploading"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
        (click)="fileInput.click()">
        <div class="upload-content" *ngIf="!isUploading && !selectedFile">
          <svg
            width="48"
            height="48"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2">
            <path
              d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14,2 14,8 20,8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10,9 9,9 8,9"></polyline>
          </svg>
          <p class="upload-text">Drag & drop your JSON file here</p>
          <p class="upload-subtext">or click to browse</p>
        </div>

        <div class="upload-content" *ngIf="selectedFile && !isUploading">
          <svg
            width="48"
            height="48"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2">
            <path
              d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14,2 14,8 20,8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10,9 9,9 8,9"></polyline>
          </svg>
          <p class="upload-text">{{ selectedFile!.name }}</p>
          <p class="upload-subtext">{{ formatFileSize(selectedFile!.size) }}</p>
        </div>

        <div class="upload-progress" *ngIf="isUploading">
          <div class="progress-circle">
            <svg width="60" height="60" viewBox="0 0 60 60">
              <circle
                cx="30"
                cy="30"
                r="25"
                fill="none"
                stroke="#e0e0e0"
                stroke-width="4" />
              <circle
                cx="30"
                cy="30"
                r="25"
                fill="none"
                stroke="#4A90E2"
                stroke-width="4"
                stroke-linecap="round"
                [style.stroke-dasharray]="157"
                [style.stroke-dashoffset]="157 - (157 * uploadProgress / 100)"
                style="
                  transform: rotate(-90deg);
                  transform-origin: 30px 30px;
                " />
            </svg>
            <span class="progress-text">{{ uploadProgress }}%</span>
          </div>
          <p class="upload-text">Uploading...</p>
        </div>
      </div>

      <input
        #fileInput
        type="file"
        accept=".json"
        style="display: none"
        (change)="onFileSelected($event)" />
    </div>
    <div *ngIf="validationErrors.length > 0" class="error-messages">
      <h4>Configuration Errors:</h4>
      <ul>
        <li *ngFor="let error of validationErrors">{{ error }}</li>
      </ul>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
      <button
        class="btn btn-primary"
        [disabled]="!selectedFile || isUploading"
        (click)="uploadFile()">
        Upload
      </button>
    </div>
  </div>
</div>
